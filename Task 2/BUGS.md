# BUGS.md - Отчет о найденных багах

## 1. Отсутствие валидации sellerID при создании объявления

**Приоритет:** High

**Описание:**  
API не проверяет корректность sellerID при создании объявления. Принимаются любые числовые значения, включая те, которые не соответствуют документации (диапазон 111111-999999).

**Шаги воспроизведения:**

1. Отправить POST запрос на `/api/1/item` с sellerID=123:

```json
{
	"sellerID": 123,
	"name": "Test",
	"price": 1000,
	"statistics": {
		"likes": 10,
		"viewCount": 20,
		"contacts": 30
	}
}
```

**Ожидаемый результат:**

- Статус 400 Bad Request
- Сообщение об ошибке валидации sellerID

**Фактический результат:**

- Статус 200 OK
- Объявление успешно создается

**Влияние:**  
В систему могут попасть данные с некорректными sellerID, что может привести к проблемам при поиске и фильтрации объявлений.

---

## 2. Ограничения максимальной длины и знак отрицания, даже для id пользователя

**Приоритет:** High

**Описание:**  
Все поля типа `int` имеют ограничений по максимальной длине (18 символов) и могут принимать отрицательные значения, включая `sellerID`.

**Шаги воспроизведения:**

1. Отправить POST запрос на `/api/1/item` с очень отрицательными числами числами:

```json
{
	"sellerID": -99999999999999999,
	"name": "Test",
	"price": -99999999999999999,
	"statistics": {
		"likes": -99999999999999999,
		"viewCount": -99999999999999999,
		"contacts": -99999999999999999
	}
}
```

**Ожидаемый результат:**

- Статус 400 Bad Request
- Сообщение о отрицательных данных 

**Фактический результат:**

- Статус 200 OK
- Объявление успешно создается

**Влияение:**  
Может привести к некорректным вычислениям и проблемам с отображением данных на фронтенде.

---

## 3. Некорректная обработка sellerID=0 и sellerID=-2 в GET запросах

**Приоритет:** High

**Описание:**  
GET запросы на `/api/1/{sellerID}/item` принимают и обрабатывают sellerID=0 и sellerID=-2, хотя такие значения не должны считаться валидными идентификаторами продавцов.

**Шаги воспроизведения:**

1. Отправить GET запрос на `/api/1/0/item`
2. Отправить GET запрос на `/api/1/-2/item`

**Ожидаемый результат:**

- Статус 400 Bad Request для обоих запросов
- Сообщение о некорректном sellerID

**Фактический результат:**

- Статус 200 OK для обоих запросов
- Возвращаются существующие объявления

**Влияние:**  
Нарушение целостности данных и потенциальные проблемы при фильтрации объявлений по sellerID.

---

## 4. Разные форматы ошибок при невалидных sellerID

**Приоритет:** Medium

**Описание:**  
API возвращает разные форматы ошибок в зависимости от типа невалидного sellerID.

**Шаги воспроизведения:**

1. Отправить GET запрос на `/api/1/abc/item` (текстовый sellerID)
2. Отправить GET запрос на `/api/1/!@#%$/item` (спецсимволы)

**Ожидаемый результат:**

- Одинаковый формат ошибки для всех невалидных случаев
- Статус 400 Bad Request

**Фактический результат:**

- Для "abc": `{"result": {"message": "...", "messages": {}}, "status": "400"}`
- Для "!@#%$": `{"message": "route /api/1/!@ not found", "code": 400}`

**Влияние:**  
Усложняет обработку ошибок на клиентской стороне.

---

## 5. Некорректное кодирование спецсимволов в сообщениях об ошибках

**Приоритет:** Low

**Описание:**  
При передаче ID с кириллицей и спецсимволами в сообщении об ошибке отображаются закодированные символы.

**Шаги воспроизведения:**

1. Отправить GET запрос на `/api/1/item/fb32а45f-b394-402а-ас54-е1е62bb9987!`

**Ожидаемый результат:**

- Читаемое сообщение об ошибке
- Корректное отображение кириллицы и спецсимволов

**Фактический результат:**

```
"ID айтема не UUID: fb32%D0%B045f-b394-402%D0%B0-%D0%B0%D1%8154-%D0%B51%D0%B562bb9987!"
```

**Влияние:**  
Пользователю сложно понять, в чем именно ошибка.

---

## 6. Неправильная обработка нулевых значений в числовых полях

**Приоритет:** Medium

**Описание:**  
При передаче `0` в числовые поля API возвращает ошибку "Поле обязательно", хотя `0` является валидным числовым значением.

**Шаги воспроизведения:**

1. Отправить POST запрос с нулевыми значениями:

```json
{
	"sellerID": 123456,
	"name": "Test",
	"price": 0,
	"statistics": {
		"likes": 0,
		"viewCount": 0,
		"contacts": 0
	}
}
```

**Ожидаемый результат:**

- Статус 200 OK
- Объявление успешно создается с нулевыми значениями

**Фактический результат:**

- Статус 400 Bad Request
- Сообщение "поле price обязательно" (или аналогичное для других полей)

**Влияние:**  
Невозможно создать объявления с нулевой ценой или нулевой статистикой, что ограничивает функциональность.

---

## 7. Отсутствие ограничений по длине для поля name

**Приоритет:** high

**Описание:**  
Поле `name` не имеет ограничений по максимальной длине строки.

**Шаги воспроизведения:**

1. Отправить POST запрос с очень длинным именем:

```json
{
	"sellerID": 123456,
	"name": "Очень длинное название объявления, которое занимает много места и может вызвать проблемы с отображением на фронтенде, а также потенциальные проблемы с базой данных из-за отсутствия ограничений по длине строки...",
	"price": 1000,
	"statistics": {
		"likes": 10,
		"viewCount": 20,
		"contacts": 30
	}
}
```

**Ожидаемый результат:**

- Статус 400 Bad Request при превышении разумных лимитов
- Сообщение о превышении максимальной длины

**Фактический результат:**

- Статус 200 OK
- Объявление создается с очень длинным именем

**Влияние:**  
Может вызвать проблемы с отображением на фронтенде, переполнение базы данных и ухудшение производительности.

---

## 8. Некорректный статус кода при невалидном ID статистики

**Приоритет:** low

**Описание:**  
При передаче невалидного идентификатора в запросе статистики возвращается статус 404, но в теле ответа указан статус 400.

**Шаги воспроизведения:**

1. Отправить GET запрос на `/api/1/statistic/невалидный-id`

**Ожидаемый результат:**

- Статус 400 Bad Request
- Консистентное сообщение об ошибке

**Фактический результат:**

- Статус 404 Not Found
- В теле ответа: `"status": "400"`

**Влияние:**  
Усложняет обработку ошибок на клиентской стороне из-за противоречия между заголовком ответа и телом.

---

## 9. Неправильный Content-Type при ошибках с специальными символами

**Приоритет:** Low

**Описание:**  
При добавлении `%%` в параметры запроса API возвращает HTML страницу вместо JSON.

**Шаги воспроизведения:**

1. Отправить GET запрос на `/api/1/item/%%test%%`

**Ожидаемый результат:**

- Статус 400 Bad Request
- Ответ в формате JSON с сообщением об ошибке

**Фактический результат:**

- Статус 400 Bad Request
- Ответ в формате HTML:

```html
<html>
	<head></head>
	<body>
		QRATOR HTTP 400
	</body>
</html>
```

**Влияние:**  
Нарушает консистентность API и усложняет обработку ошибок на клиентской стороне.

---

## 10. Дублирование информации о timezone в поле createdAt

**Приоритет:** medium

**Описание:**  
В поле `createdAt` информация о часовом поясе дублируется: `2025-12-29 03:07:56.031529 +0300 +0300`

**Шаги воспроизведения:**

1. Создать любое объявление через POST /api/1/item
2. Получить его через GET /api/1/item/{id}
3. Проверить поле `createdAt`

**Ожидаемый результат:**

- Формат: `2025-12-29 03:07:56.031529 +0300`

**Фактический результат:**

- Формат: `2025-12-29 03:07:56.031529 +0300 +0300`

**Влияние:**  
Некорректный формат даты, может вызвать проблемы при парсинге на клиентской стороне.

---

## 11. Отсутствие пагинации при получении объявлений продавца

**Приоритет:** Medium

**Описание:**  
API endpoint `/api/1/{sellerID}/item` не поддерживает пагинацию.

**Шаги воспроизведения:**

1. Предположим, у продавца с ID=462322 есть 1000+ объявлений
2. Отправить GET запрос на `/api/1/462322/item`

**Ожидаемый результат:**

- Поддержка параметров пагинации (limit, offset)
- Частичный возврат данных с информацией о количестве страниц

**Фактический результат:**

- Возвращаются все объявления продавца
- Нет параметров для ограничения или разбивки на страницы

**Влияние:**  
Потенциальные проблемы с производительностью при большом количестве объявлений и увеличение времени загрузки.

---

## 12. Неподходящий статус код для ошибок валидации

**Приоритет:** Low

**Описание:**  
Для ошибок валидации данных лучше использовать статус 422 (Unprocessable Entity) вместо 400 (Bad Request).

**Шаги воспроизведения:**

1. Отправить POST запрос с некорректными типами данных

**Ожидаемый результат:**

- Статус 422 Unprocessable Entity для ошибок валидации
- Статус 400 Bad Request для синтаксических ошибок

**Фактический результат:**

- Все ошибки возвращают статус 400 Bad Request

**Влияние:**  
Усложняет различение синтаксических ошибок и ошибок валидации на клиентской стороне.

---
