# TESTCASES.md - Тест-кейсы для микросервиса объявлений Avito

## Общая информация

**Тестируемый API:** Микросервис объявлений Avito  
**Базовый URL:** https://qa-internship.avito.com  
**Формат данных:** JSON  
**Кодировка:** UTF-8

## Тест-кейсы

### 1. Создание объявления (POST /api/1/item)

#### 1.1. Успешное создание объявления с валидными данными

**ID:** TC-API-001  
**Приоритет:** Высокий  
**Предусловия:** Нет  
**Шаги:**

1. Отправить POST запрос на /api/1/item с корректными данными:

```json
{
	"sellerID": 462322,
	"name": "Тестовое объявление",
	"price": 1000,
	"statistics": {
		"likes": 10,
		"viewCount": 20,
		"contacts": 30
	}
}
```

2. Проверить статус ответа

**Ожидаемый результат:**

- Статус код: 200 OK
- В теле ответа присутствует статус создания
- ID объявления генерируется уникальным

**Фактический результат:**

- Статус 200 OK ✓
- Ответ: `{"status": "Сохранили объявление - <UUID>"}`
- **Расхождение:** Структура ответа не соответствует документации

#### 1.2. Создание объявления с невалидными типами данных

**ID:** TC-API-002  
**Приоритет:** Высокий  
**Предусловия:** Нет  
**Шаги:**

1. Отправить POST запрос с текстовыми значениями в числовых полях:

```json
{
	"sellerID": "не число",
	"name": 123,
	"price": "текст",
	"statistics": {
		"likes": "текст",
		"viewCount": "текст",
		"contacts": "текст"
	}
}
```

**Ожидаемый результат:**

- Статус код: 400 Bad Request
- Понятное сообщение об ошибке валидации типов

**Фактический результат:**

- Статус 400 Bad Request ✓
- Ответ: `{"result": {"message": "", "messages": {}}, "status": "не передано тело объявления"}`
- **Проблема:** Сообщение об ошибке непонятное

#### 1.3. Проверка уникальности ID объявлений

**ID:** TC-API-003  
**Приоритет:** Средний  
**Предусловия:** Нет  
**Шаги:**

1. Создать первое объявление с тестовыми данными
2. Создать второе объявление с идентичными данными
3. Сравнить ID созданных объявлений

**Ожидаемый результат:**

- Оба запроса возвращают 200 OK
- ID объявлений разные

**Фактический результат:**

- Статус 200 OK для обоих запросов ✓
- ID действительно разные ✓
- Пример: `87a021c7-2618-4e10-9ab1-fe7c6b7b614b` и `d7d270c4-54f3-4678-a16c-3ad788697208`

#### 1.4. Создание с некорректным sellerID

**ID:** TC-API-004  
**Приоритет:** Высокий  
**Предусловия:** Нет  
**Шаги:**

1. Отправить POST запрос с sellerID вне диапазона 111111-999999:

```json
{
	"sellerID": 123,
	"name": "Тест",
	"price": 1000,
	"statistics": {
		"likes": 10,
		"viewCount": 20,
		"contacts": 30
	}
}
```

**Ожидаемый результат:**

- Статус код: 400 Bad Request
- Сообщение об ошибке валидации sellerID

**Фактический результат:**

- Статус 200 OK
- Объявление успешно создается
- **Баг:** Отсутствует валидация sellerID

#### 1.5. Проверка обязательных полей

**ID:** TC-API-005  
**Приоритет:** Высокий  
**Предусловия:** Нет  
**Шаги:**

1. Поочередно отправлять запросы, где одно из полей имеет значение null
2. Проверять ответ для каждого случая

**Ожидаемый результат:**

- Статус код: 400 Bad Request для каждого случая
- Понятное сообщение о том, какое поле обязательно

**Фактический результат:**

- Статус 400 Bad Request для всех обязательных полей ✓
- Понятные сообщения об ошибках ✓
- Примеры:
  - `"поле sellerID обязательно"`
  - `"поле likes обязательно"`

#### 1.6. Проверка отрицательных значений

**ID:** TC-API-006  
**Приоритет:** Высокий  
**Предусловия:** Нет  
**Шаги:**

1. Отправить POST запрос с отрицательными значениями:

```json
{
	"sellerID": -123963,
	"name": "Тест",
	"price": -100,
	"statistics": {
		"likes": -10,
		"viewCount": -20,
		"contacts": -30
	}
}
```

**Ожидаемый результат:**

- Статус код: 400 Bad Request
- Сообщение о некорректных значениях

**Фактический результат:**

- Статус 200 OK
- Объявление успешно создается
- **Баг:** Принимаются отрицательные значения

### 2. Получение объявления по ID (GET /api/1/item/{id})

#### 2.1. Получение существующего объявления

**ID:** TC-API-007  
**Приоритет:** Высокий  
**Предусловия:** Создано тестовое объявление  
**Шаги:**

1. Получить ID созданного объявления
2. Отправить GET запрос на /api/1/item/{id}
3. Проверить ответ

**Ожидаемый результат:**

- Статус код: 200 OK
- Тело ответа содержит данные объявления в формате массива
- Все поля соответствуют созданному объявлению

**Фактический результат:**

- Статус 200 OK ✓
- Ответ в формате массива с одним объектом ✓
- Все поля присутствуют ✓

#### 2.2. Получение несуществующего объявления

**ID:** TC-API-008  
**Приоритет:** Средний  
**Предусловия:** Нет  
**Шаги:**

1. Сгенерировать случайный UUID
2. Отправить GET запрос с несуществующим ID

**Ожидаемый результат:**

- Статус код: 404 Not Found
- Сообщение о том, что объявление не найдено

**Фактический результат:**

- Статус 404 Not Found ✓
- Ответ: `{"result": {"message": "item ... not found", "messages": null}, "status": "404"}` ✓

#### 2.3. Получение с некорректным форматом ID

**ID:** TC-API-009  
**Приоритет:** Средний  
**Предусловия:** Нет  
**Шаги:**

1. Отправить GET запрос с ID неправильной длины
2. Отправить GET запрос с ID содержащим кириллицу
3. Отправить GET запрос с ID содержащим спецсимволы

**Ожидаемый результат:**

- Статус код: 400 Bad Request
- Сообщение о некорректном формате ID

**Фактический результат:**

- Статус 400 Bad Request для всех случаев ✓
- Сообщения об ошибках корректные ✓
- **Замечание:** При спецсимволах в ID происходит некорректное кодирование в сообщении об ошибке

### 3. Получение статистики (GET /api/1/statistic/{id})

#### 3.1. Получение статистики существующего объявления

**ID:** TC-API-010  
**Приоритет:** Высокий  
**Предусловия:** Создано тестовое объявление  
**Шаги:**

1. Получить статистику для созданного объявления
2. Проверить структуру ответа

**Ожидаемый результат:**

- Статус код: 200 OK
- Тело ответа содержит статистику в формате массива
- Присутствуют поля likes, viewCount, contacts

**Фактический результат:**

- Статус 200 OK ✓
- Ответ в формате массива ✓
- Все поля статистики присутствуют ✓

#### 3.2. Получение статистики несуществующего объявления

**ID:** TC-API-011  
**Приоритет:** Средний  
**Предусловия:** Нет  
**Шаги:**

1. Запросить статистику для несуществующего ID

**Ожидаемый результат:**

- Статус код: 404 Not Found
- Сообщение о том, что статистика не найдена

**Фактический результат:**

- Статус 404 Not Found ✓
- Корректное сообщение об ошибке ✓

#### 3.3. Получение статистики с некорректным ID

**ID:** TC-API-012  
**Приоритет:** Средний  
**Предусловия:** Нет  
**Шаги:**

1. Запросить статистику с ID неправильного формата

**Ожидаемый результат:**

- Статус код: 400 Bad Request
- Сообщение о некорректном идентификаторе

**Фактический результат:**

- Статус 400 Bad Request ✓
- Ответ: `{"result": {"message": "передан некорректный идентификатор объявления", "messages": {}}, "status": "400"}` ✓

### 4. Получение объявлений продавца (GET /api/1/{sellerID}/item)

#### 4.1. Получение объявлений существующего продавца

**ID:** TC-API-013  
**Приоритет:** Высокий  
**Предусловия:** Создано объявление для тестового продавца  
**Шаги:**

1. Запросить все объявления для sellerID
2. Проверить ответ

**Ожидаемый результат:**

- Статус код: 200 OK
- Тело ответа содержит массив объявлений
- Все объявления принадлежат запрошенному продавцу

**Фактический результат:**

- Статус 200 OK ✓
- Ответ содержит массив объявлений ✓
- Объявления принадлежат правильному продавцу ✓

#### 4.2. Получение объявлений с невалидным sellerID

**ID:** TC-API-014  
**Приоритет:** Средний  
**Предусловия:** Нет  
**Шаги:**

1. Запросить объявления с sellerID="abc"
2. Запросить объявления с sellerID=0
3. Запросить объявления с sellerID=-2
4. Запросить объявления с sellerID="!@#%$"

**Ожидаемый результат:**

- Для нечисловых значений: 400 Bad Request
- Для значений вне диапазона: соответствующий ответ

**Фактический результат:**

- "abc" → 400 Bad Request ✓
- 0 → 200 OK (возвращает объявления) ⚠️
- -2 → 200 OK (возвращает объявления) ⚠️
- "!@#%$" → 400 Bad Request (другой формат ответа) ⚠️

### 5. Удаление объявления (DELETE /api/2/item/{id})

#### 5.1. Удаление существующего объявления

**ID:** TC-API-015  
**Приоритет:** Высокий  
**Предусловия:** Создано тестовое объявление  
**Шаги:**

1. Удалить созданное объявление
2. Проверить, что удаление прошло успешно
3. Попытаться получить удаленное объявление

**Ожидаемый результат:**

- Статус код при удалении: 200 OK
- При попытке получить удаленное объявление: 404 Not Found

**Фактический результат:**

- Статус при удалении: 200 OK (пустой ответ) ✓
- Статус при получении: 404 Not Found ✓

#### 5.2. Удаление несуществующего объявления

**ID:** TC-API-016  
**Приоритет:** Средний  
**Предусловия:** Нет  
**Шаги:**

1. Попытаться удалить несуществующее объявление

**Ожидаемый результат:**

- Статус код: 404 Not Found

**Фактический результат:**

- Статус 404 Not Found ✓
- **Замечание:** В теле ответа status: "500" ⚠️

#### 5.3. Удаление с некорректным ID

**ID:** TC-API-017  
**Приоритет:** Средний  
**Предусловия:** Нет  
**Шаги:**

1. Попытаться удалить объявление с ID неправильного формата

**Ожидаемый результат:**

- Статус код: 400 Bad Request
- Сообщение о некорректном ID

**Фактический результат:**

- Статус 400 Bad Request ✓
- Ответ: `{"result": {"message": "переданный id айтема некорректный", "messages": {}}, "status": "400"}` ✓

## Сводка результатов тестирования

### Пройденные тесты (✓):

- Создание объявления с валидными данными (TC-API-001)
- Уникальность ID объявлений (TC-API-003)
- Проверка обязательных полей (TC-API-005)
- Получение существующего объявления (TC-API-007)
- Получение несуществующего объявления (TC-API-008)
- Получение с некорректным форматом ID (TC-API-009)
- Получение статистики (TC-API-010, 011, 012)
- Получение объявлений продавца (TC-API-013)
- Удаление объявлений (TC-API-015, 016, 017)

### Найденные баги (⚠️):

1. **Отсутствует валидация sellerID** (TC-API-004)

   - Принимаются значения вне диапазона 111111-999999
   - Приоритет: Высокий

2. **Принимаются отрицательные значения** (TC-API-006)

   - price, likes, viewCount, contacts могут быть отрицательными
   - Приоритет: Высокий

3. **sellerID=0 и sellerID=-2 работают в GET** (TC-API-014)

   - Возвращают объявления, хотя через POST нельзя создать
   - Приоритет: Средний

4. **Несоответствие документации** (TC-API-001)

   - Структура ответов отличается от документации в Postman
   - Приоритет: Низкий

5. **Разные форматы ошибок** (TC-API-014)
   - Для разных случаев ошибки возвращаются в разном формате
   - Приоритет: Низкий

### Рекомендации:

1. **Срочно:** Добавить валидацию числовых полей
2. **Важно:** Унифицировать форматы ответов
3. **Средний приоритет:** Исправить обработку sellerID=0
4. **Низкий приоритет:** Обновить документацию

## Заключение

API выполняет основные CRUD операции, но требует доработки валидации входных данных. Критические функции работают корректно, однако отсутствие валидации может привести к некорректным данным в системе. Рекомендуется начать с исправления валидации sellerID и отрицательных значений.
